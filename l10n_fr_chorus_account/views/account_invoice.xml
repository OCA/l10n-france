<?xml version="1.0" encoding="utf-8"?>
<!--
  Â© 2017 Akretion (Alexis de Lattre <alexis.delattre@akretion.com>)
  License AGPL-3.0 or later (http://www.gnu.org/licenses/agpl).
-->

<odoo>


<record id="invoice_form" model="ir.ui.view">
    <field name="name">Chorus support on Customer Invoice form view</field>
    <field name="model">account.invoice</field>
    <field name="inherit_id" ref="account_invoice_transmit_method.invoice_form"/>
    <field name="arch" type="xml">
        <button name="action_invoice_sent" position="after">
            <button name="chorus_send_invoice" type="object" attrs="{'invisible': ['|', '|', ('sent', '=', True), ('state', 'not in', ('open', 'paid')), ('transmit_method_code', '!=', 'fr-chorus')]}" string="Send to Chorus" class="btn-primary" groups="l10n_fr_chorus_account.group_chorus_api"/>
        </button>
        <notebook position="inside">
            <page name="fr-chorus" string="Chorus" attrs="{'invisible': [('transmit_method_code', '!=', 'fr-chorus')]}" groups="l10n_fr_chorus_account.group_chorus_api">
                <group name="chorus-main">
                    <group name="chorus-flow">
                        <field name="chorus_flow_ref"/>
                        <field name="chorus_flow_date"/>
                        <field name="chorus_format"/>
                        <field name="chorus_flow_status"/>
                        <field name="chorus_flow_status_date"/>
                        <button name="chorus_update_flow_status" type="object" string="=> Update Chorus Flow Status" attrs="{'invisible': ['|', ('chorus_flow_ref', '=', False), ('chorus_flow_status', '=', 'IN_INTEGRE')]}" colspan="2" class="oe_link"/>
                    </group>
                    <group name="chorus-invoice">
                        <field name="chorus_identifier"/>
                        <button name="chorus_get_identifier" type="object" string="=> Get Chorus Identifier" attrs="{'invisible': ['|', ('chorus_identifier', 'not in', (0, False)), ('chorus_flow_status', '!=', 'IN_INTEGRE')]}" colspan="2" class="oe_link"/>
                        <field name="chorus_status"/>
                        <field name="chorus_status_date"/>
                        <button name="chorus_update_invoice_status" type="object" string="=> Update Chorus Invoice Status" attrs="{'invisible': [('chorus_identifier', 'in', (False, 0))]}" colspan="2" class="oe_link"/>
                    </group>
                </group>
            </page>
        </notebook>
    </field>
</record>

<record id="view_account_invoice_filter" model="ir.ui.view">
    <field name="name">Chorus groupby on Invoice search view</field>
    <field name="model">account.invoice</field>
    <field name="inherit_id" ref="account.view_account_invoice_filter"/>
    <field name="arch" type="xml">
        <filter context="{'group_by':'date_due'}" position="after">
            <filter string="Chorus Status" name="chorus_status_groupby" context="{'group_by': 'chorus_status'}" groups="l10n_fr_chorus_account.group_chorus_api"/>
        </filter>
    </field>
</record>


</odoo>
